# 智能语音助手 - Web界面

## 📝 最近更新

### v2.8.0 (2024-12-22)
- 🎙️ **语音图标**: 将语音输入按钮从PNG图片替换为SVG矢量图标
- 🔴 **状态指示**: 添加录音中状态文本和右上角闪烁红点指示器
- 💫 **视觉反馈**: 录音状态下按钮变色并添加多种动画效果
- 🎭 **交互优化**: 麦克风图标呼吸动画，提供更直观的录音状态反馈

### v2.7.0 (2024-12-22)
- 🏗️ **结构优化**: 将输入框移出聊天容器，放置在外层结构中
- 🔄 **功能重构**: 简化newChat函数，不再需要保存和恢复输入框
- 🐛 **Bug修复**: 彻底解决清空对话后输入框消失的问题
- 🧹 **代码精简**: 移除不必要的输入框保存和恢复逻辑

### v2.6.0 (2024-12-22)
- 🐛 **Bug修复**: 修复清空对话后输入框消失的问题
- 🔧 **功能修复**: 修复设置弹窗右上角关闭按钮无法工作的问题
- 🧠 **逻辑优化**: 改进newChat函数，保留输入框元素并重新绑定事件
- 🔗 **事件绑定**: 为设置弹窗的关闭按钮添加点击事件处理

### v2.5.0 (2024-12-22)
- 🧹 **功能精简**: 移除左侧工具栏中的新建对话按钮，仅保留清空对话功能
- 🔄 **功能合并**: 将新建对话功能整合到清空对话按钮中
- 🎨 **按钮优化**: 改进设置弹窗中取消和保存按钮的样式和排序
- 🎯 **交互优化**: 符合用户习惯的按钮排列，取消在左，确认在右

### v2.4.0 (2024-12-22)
- 📏 **缩放优化**: 调整UI元素尺寸，使100%缩放下显示合适
- 🔤 **字体调整**: 优化字体大小计算逻辑，适应不同屏幕尺寸
- 📱 **布局精简**: 减小边距和内边距，使界面更紧凑高效
- 🎛️ **按钮优化**: 调整按钮尺寸和位置，提高操作便捷性

### v2.3.0 (2024-12-22)
- 🖼️ **背景重构**: 将聊天背景图从聊天容器移至整个应用容器，实现全局背景效果
- 🔄 **层次优化**: 调整DOM结构，使背景图覆盖整个应用区域
- 🧹 **代码清理**: 移除冗余的背景设置，简化CSS结构
- 🎨 **视觉统一**: 让背景图覆盖整个应用，提供一致的视觉体验

### v2.2.0 (2024-12-22)
- 🧹 **界面简化**: 移除多余的背景层次，只保留必要的背景图片
- 🔍 **视觉透明**: 移除半透明遮罩层，使聊天背景图完全可见
- 🎨 **纯净设计**: 移除主内容区域的背景色和阴影，提升视觉通透感
- 🖼️ **背景聚焦**: 简化app-container背景，突出聊天区域背景图

### v2.1.0 (2024-12-22)
- 🖼️ **留白设计**: 调整布局，在四周留出空间，使底层背景可见
- 🎨 **透明头部**: 聊天头部背景设为透明，添加毛玻璃效果
- 📱 **移动端优化**: 改进小屏幕设备上的边距和布局
- 🔳 **圆角优化**: 为聊天容器添加圆角，提升整体视觉协调性

这是一个基于web_client功能重构的现代化语音识别和聊天界面，保留了原有的思源大模型设计风格，并提供了完整的交互功能。

## 🎯 主要功能

### 🎙️ 语音识别
- **实时录音**: 点击麦克风按钮开始/停止录音
- **自动识别**: 语音自动转换为文字并发送给AI
- **多种采样率支持**: 8kHz、16kHz、44.1kHz、48kHz
- **智能重连**: WebSocket断线自动重连机制

### 💬 AI对话
- **流式响应**: 实时显示AI回复内容
- **多模型支持**: 兼容Ollama API格式
- **自动发送**: 语音识别结果自动发送给AI
- **请求中断**: 可中断正在进行的AI请求

### ⚙️ 设置管理
- **弹窗设置**: 现代化的设置弹窗界面
- **API配置**: 自定义聊天模型API地址
- **音频设置**: 可调节麦克风采样率
- **参数调节**: 温度、最大Token数等生成参数
- **设置持久化**: 自动保存用户配置

### 📱 响应式设计
- **全屏布局**: 去除传统侧边栏，采用全屏沉浸式设计
- **左侧工具栏**: 透明背景工具栏，半透明按钮直接浮在背景上
- **移动端适配**: 支持移动设备使用，工具栏自动缩放
- **现代化UI**: 清晰背景图片、圆角设计、动画效果
- **操作便捷**: 主要功能一键触达，符合用户操作习惯

## 🚀 快速开始

### 1. 环境要求
- 现代浏览器（支持WebRTC、WebSocket、AudioContext）
- 语音识别服务（默认端口6016）
- 聊天模型服务（默认Ollama，端口11434）

### 2. 启动服务

#### 启动语音识别服务
```bash
# 运行语音识别服务
python core_server.py
# 或
./start_server.exe
```

#### 启动聊天模型服务
```bash
# 启动Ollama服务
ollama serve

# 拉取模型（如果尚未安装）
ollama pull qwen3-4b-custom
```

### 3. 打开web界面
```bash
# 方法1: 直接打开HTML文件
# 在浏览器中打开 web/index.html

# 方法2: 使用web服务器
python web_server.py
# 然后访问 http://localhost:8000
```

## 🔧 配置说明

### API设置
- **API地址**: 聊天模型的API端点
  - 默认: `http://localhost:11434/api/chat`
  - 支持OpenAI兼容格式和Ollama格式

### 音频设置
- **语音识别服务地址**: WebSocket连接地址
  - 默认: `ws://localhost:6016`
  - HTTPS环境下自动使用wss://
- **麦克风采样率**: 
  - 44.1 kHz (标准) - 推荐日常使用
  - 48 kHz (高质量) - 专业音频质量
  - 16 kHz (低带宽) - 网络条件不佳时
  - 8 kHz (电话质量) - 最低质量

### 生成参数（高级设置）
- **温度**: 控制AI回复的创造性（0-2）
- **最大Token数**: 限制AI回复长度
- **调试信息**: 显示详细的调试日志

## 🎮 使用方法

### 语音输入
1. 点击🎙️录音按钮开始录音
2. 说话后点击🛑停止录音
3. 等待语音识别结果
4. AI会自动回复

### 文字输入
1. 在输入框中输入文字
2. 按Enter键发送（Shift+Enter换行）
3. 或点击➤发送按钮
4. 等待AI回复

### 界面操作
- **侧边栏收缩**: 点击‹/›按钮
- **清空对话**: 点击🗑️按钮
- **中断请求**: 点击"中断"按钮
- **新建对话**: 点击"➕ 新建对话"

## 🔍 故障排除

### 语音识别不工作
1. 检查浏览器是否支持麦克风权限
2. 确认语音识别服务是否启动
3. 检查WebSocket连接地址是否正确
4. 查看浏览器开发者工具的控制台错误

### AI不回复
1. 确认聊天模型服务是否启动
2. 检查API地址是否正确
3. 验证模型名称是否存在
4. 查看网络连接是否正常

### 界面显示异常
1. 刷新页面重新加载
2. 清除浏览器缓存
3. 检查CSS和JS文件是否完整
4. 确认浏览器版本是否过旧

## 🌟 特色功能

### 智能标签清理
- 自动移除AI模型的内部思考标签
- 支持多种标签格式：`<think>`、`[[reasoning]]`等
- 确保用户看到的是干净的回复内容

### 流式响应
- 实时显示AI回复过程
- 支持Ollama和OpenAI兼容API
- 平滑的打字机效果

### 防抖机制
- 避免重复发送相同请求
- 300ms防抖延迟
- 智能去重复消息

### 自动重连
- WebSocket断线自动重连
- 最多重试10次
- 录音过程中保持连接稳定

## 📋 技术栈
- **前端**: HTML5 + CSS3 + Vanilla JavaScript
- **语音处理**: Web Audio API + MediaDevices API
- **通信**: WebSocket + Fetch API
- **UI框架**: 纯CSS（无第三方依赖）
- **响应式**: CSS Grid + Flexbox + Media Queries

## 🔄 与原版对比

| 功能 | 原版web_client | 新版web界面 |
|------|----------------|-------------|
| 设计风格 | 现代简洁 | 保留思源大模型风格 |
| 响应式设计 | ✅ | ✅ 优化移动端 |
| 语音识别 | ✅ | ✅ 增强稳定性 |
| 流式回复 | ✅ | ✅ 优化显示效果 |
| 设置管理 | ✅ | ✅ 更直观的界面 |
| 调试功能 | ✅ | ✅ 可选显示 |
| 对话历史 | ❌ | ✅ 新增功能 |
| 品牌元素 | ❌ | ✅ 思源大模型品牌 |

## 🎨 视觉设计

### 设计理念
本项目完全基于思源大模型的原有设计，保持品牌视觉的一致性：

- **🖼️ 原版背景**: 使用原有的背景图片资源
- **🎯 品牌图标**: 保留所有原有的PNG图标元素
- **🎨 色彩搭配**: 维持原有的配色方案
- **📐 布局比例**: 参考原有设计的空间布局

### 背景图片层次
```
Body背景: SketchPngabbdb7def0e961481f312c7ac83f13fb0a80aea87f9a553bac885259883976a4.png
容器装饰: SketchPng3e3c277acd858784daabb2928723336dcb4d7e45414f0c9fad177d03c59400ff.png
主容器: rgba(247, 248, 252, 1) 浅灰色背景
```

### 图标资源使用
- **品牌Logo**: `SketchPngb75910db2f6834b4307ff67a6302390191809af1f9e3009995597797e506e343.png`
- **录音图标**: `SketchPng8a862a4590868449e10bf1a88e68bab6520fbc1d512a82f3d98d54e1f6b611ed.png`
- **停止图标**: `SketchPng5301bf121cc625d6d42f0038167282654862f005241d58816efe7b5925a0cd0a.png`
- **发送图标**: `SketchPng4f35b6c56f3d6939ddb5ece38bf51cf7a7bb6e00d1e824e41e0d23ffde8bd432.png`
- **清除图标**: `SketchPng135fcd0c92349ec205f6efa43a93bda8b970f1d44ea754be533bb78abd7708d0.png`
- **删除图标**: `SketchPngb025ef34573b8224bddcce29a5b3dd0fe7df009ad2a86b4d02e64375b7cc2793.png`

### 聊天背景定制
- **聊天背景**: `chat-background.png` - 聊天区域的自定义背景图片
- **半透明覆盖**: 自动添加白色半透明层确保文字可读性
- **响应式适配**: 不同设备上自动调整透明度
  - 桌面端: 85% 透明度
  - 平板端: 90% 透明度  
  - 手机端: 92% 透明度

## 📐 屏幕适配

### 支持的屏幕尺寸
- **大屏幕** (≥1920px): 完整功能，最佳体验
- **中大屏幕** (1200px-1919px): 紧凑布局，保持功能完整
- **平板** (768px-1199px): 侧边栏可收缩，触摸优化
- **手机** (480px-767px): 侧边栏全屏弹出，移动端优化
- **小屏幕** (320px-479px): 极简布局，核心功能保留

### 布局特性
- 🔄 **自适应字体**: 根据屏幕尺寸动态调整
- 📱 **移动端优化**: 防止iOS Safari缩放，优化触摸体验
- 🔄 **横屏适配**: 自动适应设备旋转
- 🎯 **无横向滚动**: 防止布局溢出
- 🖼️ **背景适配**: 不同设备上背景图片自动调整透明度

### 测试布局
1. **桌面端**: 调整浏览器窗口大小测试响应式
2. **移动端**: 在手机浏览器中直接访问
3. **开发者工具**: 使用Chrome DevTools模拟不同设备

## 📝 更新日志

### v2.0.0 (2024-12-19)
- 🚀 **架构重构**: 完全移除侧边栏，采用全屏单页面设计
- ⚙️ **设置弹窗**: 将所有设置功能集成到现代化的弹窗界面中
- 🎨 **背景优化**: 大幅降低聊天背景白色遮罩透明度(0.75→0.15)，背景图片更清晰可见
- 📱 **响应式优化**: 移除侧边栏相关的媒体查询，简化布局适配逻辑
- 🎯 **操作集中**: 设置、新建对话等功能统一放置在聊天头部
- 🧹 **代码精简**: 清理大量不再需要的侧边栏相关CSS和HTML代码
- 📦 **结构优化**: 简化输入框结构，移除多余的容器包装层
- 🎪 **输入框重新设计**: 输入框移至聊天区域底部中央，长度适中，悬浮式设计
- 🎚️ **左侧工具栏**: 新增透明左侧工具栏，半透明按钮直接浮在背景上，竖直排列主要操作按钮

### v1.5.0 (2024-12-19)
- 🎨 **侧边栏重设计**: 将侧边栏背景改为纯白色，提供更简洁的视觉体验
- 🧹 **功能精简**: 移除历史对话功能和搜索框，专注于当前对话体验
- 🎯 **新建对话突出**: 新建对话按钮采用蓝色渐变，成为侧边栏的视觉焦点
- 📝 **设置面板优化**: 调整文字颜色和样式，适配白色背景

### v1.4.0 (2024-12-19)
- 🎨 **界面重设计**: 采用现代化蓝白配色，更符合思源大模型的品牌形象
- 📦 **输入框升级**: 添加层次感阴影效果，悬停和聚焦时的动态交互
- 🔍 **搜索功能**: 在侧边栏添加对话搜索框，支持快速查找历史对话
- ➕ **新建对话按钮**: 优化新建对话的用户体验，添加视觉反馈
- 💬 **消息样式**: 改进消息气泡的设计，增强视觉层次感
- 🎯 **按钮优化**: 重新设计所有交互按钮，提供更好的触觉反馈

### v1.3.0 (2024-12-19)
- 🖼️ **聊天背景定制**: 支持为聊天区域添加自定义背景图片
- 🎨 **智能透明度**: 自动添加半透明覆盖层确保文字可读性
- 📱 **响应式背景**: 不同设备上背景透明度自动调整
- 🔧 **层级管理**: 优化背景图片和内容的层级关系

### v1.2.0 (2024-12-19)
- 🎨 **视觉还原**: 恢复原有设计的背景图片和视觉风格
- 🖼️ **图标优化**: 使用原有设计中的PNG图标，替换emoji图标
- 🎭 **品牌一致**: 完全保持思源大模型的原有视觉设计
- 🌈 **背景层次**: 添加多层背景图片，营造丰富的视觉效果
- 📱 **移动端适配**: 优化背景图片在不同设备上的显示效果

### v1.1.0 (2024-12-19)
- 🔧 **布局优化**: 修复不同屏幕尺寸下的显示问题
- 📱 **响应式增强**: 添加更多断点，优化移动端体验
- 🎯 **字体适配**: 智能调整字体大小，避免内容过小或过大
- 🚫 **横向滚动修复**: 防止在小屏幕上出现横向滚动条
- 📐 **极小屏幕支持**: 支持320px以下的设备
- 🔄 **横屏模式**: 优化横屏显示效果

### v1.0.0 (2024-12-19)
- 🎉 初始版本发布
- ✨ 完整的语音识别和AI对话功能
- 🎨 现代化UI设计，保留品牌风格
- 📱 响应式设计，支持移动端
- ⚙️ 完善的设置管理系统
- 🔧 智能重连和错误处理机制

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

基于原项目许可证，南强智视(厦门)科技有限公司版权所有。